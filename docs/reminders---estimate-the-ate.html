<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Reminders - Estimate the ATE | Inserm Workshop 282 - practical session</title>
  <meta name="description" content="Chapter 2 Reminders - Estimate the ATE | Inserm Workshop 282 - practical session" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Reminders - Estimate the ATE | Inserm Workshop 282 - practical session" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Chapter 2 Reminders - Estimate the ATE | Inserm Workshop 282 - practical session" />
  <meta name="github-repo" content="Inserm_workshop_282" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Reminders - Estimate the ATE | Inserm Workshop 282 - practical session" />
  
  <meta name="twitter:description" content="Chapter 2 Reminders - Estimate the ATE | Inserm Workshop 282 - practical session" />
  

<meta name="author" content="Benoît Lepage" />


<meta name="date" content="2025-10-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="applying-the-cmaverse.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Inserm_workshop_282</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#data-generating-system"><i class="fa fa-check"></i><b>1.1</b> Data generating system</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="reminders---estimate-the-ate.html"><a href="reminders---estimate-the-ate.html"><i class="fa fa-check"></i><b>2</b> Reminders - Estimate the ATE</a>
<ul>
<li class="chapter" data-level="2.1" data-path="reminders---estimate-the-ate.html"><a href="reminders---estimate-the-ate.html#estimation-of-the-average-total-effect-ate-by-g-computation"><i class="fa fa-check"></i><b>2.1</b> Estimation of the Average Total Effect (ATE) by g-computation</a></li>
<li class="chapter" data-level="2.2" data-path="reminders---estimate-the-ate.html"><a href="reminders---estimate-the-ate.html#estimation-of-the-ate-by-iptw"><i class="fa fa-check"></i><b>2.2</b> Estimation of the ATE by IPTW</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="reminders---estimate-the-ate.html"><a href="reminders---estimate-the-ate.html#classic-horvitz-thompson-estimator"><i class="fa fa-check"></i><b>2.2.1</b> “Classic” Horvitz Thompson estimator</a></li>
<li class="chapter" data-level="2.2.2" data-path="reminders---estimate-the-ate.html"><a href="reminders---estimate-the-ate.html#stabilized-iptw-for-the-ate"><i class="fa fa-check"></i><b>2.2.2</b> Stabilized IPTW for the ATE</a></li>
<li class="chapter" data-level="2.2.3" data-path="reminders---estimate-the-ate.html"><a href="reminders---estimate-the-ate.html#using-an-msm-estimated-by-iptw"><i class="fa fa-check"></i><b>2.2.3</b> Using an MSM estimated by IPTW</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="applying-the-cmaverse.html"><a href="applying-the-cmaverse.html"><i class="fa fa-check"></i><b>3</b> Applying the CMAverse</a>
<ul>
<li class="chapter" data-level="3.1" data-path="applying-the-cmaverse.html"><a href="applying-the-cmaverse.html#estimation-by-parametric-g-computation"><i class="fa fa-check"></i><b>3.1</b> Estimation by “parametric” g-computation</a></li>
<li class="chapter" data-level="3.2" data-path="applying-the-cmaverse.html"><a href="applying-the-cmaverse.html#estimation-by-msm-estimated-by-iptw"><i class="fa fa-check"></i><b>3.2</b> Estimation by MSM estimated by IPTW</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="estimate-the-ate-by-tmle.html"><a href="estimate-the-ate-by-tmle.html"><i class="fa fa-check"></i><b>4</b> Estimate the ATE by TMLE</a>
<ul>
<li class="chapter" data-level="4.1" data-path="estimate-the-ate-by-tmle.html"><a href="estimate-the-ate-by-tmle.html#tmle-for-the-ate"><i class="fa fa-check"></i><b>4.1</b> TMLE for the ATE</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="estimate-the-cde-using-the-ltmle-package.html"><a href="estimate-the-cde-using-the-ltmle-package.html"><i class="fa fa-check"></i><b>5</b> Estimate the CDE using the <code>ltmle</code> package</a>
<ul>
<li class="chapter" data-level="5.1" data-path="estimate-the-cde-using-the-ltmle-package.html"><a href="estimate-the-cde-using-the-ltmle-package.html#ChapGcomp-CDE-ICE"><i class="fa fa-check"></i><b>5.1</b> G-computation by iterative conditional expectation</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="estimate-the-cde-using-the-ltmle-package.html"><a href="estimate-the-cde-using-the-ltmle-package.html#algorithm-and-manual-calculation"><i class="fa fa-check"></i><b>5.1.1</b> Algorithm and manual calculation</a></li>
<li class="chapter" data-level="5.1.2" data-path="estimate-the-cde-using-the-ltmle-package.html"><a href="estimate-the-cde-using-the-ltmle-package.html#g-computation-by-ice-using-the-ltmle-package"><i class="fa fa-check"></i><b>5.1.2</b> G-computation by ICE using the <code>ltmle</code> package</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="estimate-the-cde-using-the-ltmle-package.html"><a href="estimate-the-cde-using-the-ltmle-package.html#iptw-estimator-of-the-cde"><i class="fa fa-check"></i><b>5.2</b> IPTW estimator of the CDE</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="estimate-the-cde-using-the-ltmle-package.html"><a href="estimate-the-cde-using-the-ltmle-package.html#estimation-of-the-msm-coefficients-by-iptw"><i class="fa fa-check"></i><b>5.2.1</b> Estimation of the MSM coefficients by IPTW</a></li>
<li class="chapter" data-level="5.2.2" data-path="estimate-the-cde-using-the-ltmle-package.html"><a href="estimate-the-cde-using-the-ltmle-package.html#iptw-estmation-using-the-ltmle-package"><i class="fa fa-check"></i><b>5.2.2</b> IPTW estmation using the ltmle package</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="estimate-the-cde-using-the-ltmle-package.html"><a href="estimate-the-cde-using-the-ltmle-package.html#tmle-estimator-of-the-cde"><i class="fa fa-check"></i><b>5.3</b> TMLE estimator of the CDE</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="estimate-the-cde-using-the-ltmle-package.html"><a href="estimate-the-cde-using-the-ltmle-package.html#for-binary-outcomes"><i class="fa fa-check"></i><b>5.3.1</b> For binary outcomes</a></li>
<li class="chapter" data-level="5.3.2" data-path="estimate-the-cde-using-the-ltmle-package.html"><a href="estimate-the-cde-using-the-ltmle-package.html#for-continuous-outcomes"><i class="fa fa-check"></i><b>5.3.2</b> For continuous outcomes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="estimate-rnde-and-rnie-by-double-robust-estimators.html"><a href="estimate-rnde-and-rnie-by-double-robust-estimators.html"><i class="fa fa-check"></i><b>6</b> Estimate rNDE and rNIE by double robust estimators</a>
<ul>
<li class="chapter" data-level="6.1" data-path="estimate-rnde-and-rnie-by-double-robust-estimators.html"><a href="estimate-rnde-and-rnie-by-double-robust-estimators.html#g-computation-algorithm-to-compute-randomized-natural-direct-and-indirect-effects"><i class="fa fa-check"></i><b>6.1</b> G-computation algorithm to compute randomized Natural Direct and Indirect effects</a></li>
<li class="chapter" data-level="6.2" data-path="estimate-rnde-and-rnie-by-double-robust-estimators.html"><a href="estimate-rnde-and-rnie-by-double-robust-estimators.html#packages-to-get-double-robust-estimations"><i class="fa fa-check"></i><b>6.2</b> Packages to get double robust estimations</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ltmle-package-with-interval-censored-survival-data.html"><a href="ltmle-package-with-interval-censored-survival-data.html"><i class="fa fa-check"></i><b>7</b> <code>ltmle</code> package with interval censored survival data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ltmle-package-with-interval-censored-survival-data.html"><a href="ltmle-package-with-interval-censored-survival-data.html#setting"><i class="fa fa-check"></i><b>7.1</b> Setting</a></li>
<li class="chapter" data-level="7.2" data-path="ltmle-package-with-interval-censored-survival-data.html"><a href="ltmle-package-with-interval-censored-survival-data.html#data-generating-function"><i class="fa fa-check"></i><b>7.2</b> Data generating function</a></li>
<li class="chapter" data-level="7.3" data-path="ltmle-package-with-interval-censored-survival-data.html"><a href="ltmle-package-with-interval-censored-survival-data.html#inspect-the-data-generated"><i class="fa fa-check"></i><b>7.3</b> Inspect the data generated</a></li>
<li class="chapter" data-level="7.4" data-path="ltmle-package-with-interval-censored-survival-data.html"><a href="ltmle-package-with-interval-censored-survival-data.html#estimate-the-controlled-direct-effect"><i class="fa fa-check"></i><b>7.4</b> Estimate the controlled direct effect</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Inserm Workshop 282 - practical session</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="reminders---estimate-the-ate" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Reminders - Estimate the ATE<a href="reminders---estimate-the-ate.html#reminders---estimate-the-ate" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="estimation-of-the-average-total-effect-ate-by-g-computation" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Estimation of the Average Total Effect (ATE) by g-computation<a href="reminders---estimate-the-ate.html#estimation-of-the-average-total-effect-ate-by-g-computation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>G-computation can be used for the estimation of the total effect and two-way decomposition (CDE, randomized direct and indirect effects). Analogs of the 3-way and 4-way decompositions are also given by the <code>CMAverse</code> package.</p>
<p>The following steps describe the implementation of the g-computation estimator of the average total effect <span class="math inline">\(\text{ATE} = \mathbb{E}(Y_{A=1}) - \mathbb{E}(Y_{A=0})\)</span>.</p>
<ol start="0" style="list-style-type: decimal">
<li><p>The g-formula for the ATE is :
<span class="math display">\[\small \Psi^{\text{ATE}} =\sum_{l(0) \in L(0)} \mathbb{E}\left(Y \mid A=1, L(0)=l(0)\right)P(L(0) = l(0)) - \sum_{l(0) \in L(0)} \mathbb{E}\left(Y \mid A=0, L(0)=l(0)\right)P(L(0) = l(0))\]</span>
<span class="math display">\[\small \Psi^{\text{ATE}} =\sum_{l(0) \in L(0)} \overline{Q}(A=0) \times P(L(0) = l(0)) - \sum_{l(0) \in L(0)} \overline{Q}(A=1) \times P(L(0) = l(0))\]</span></p></li>
<li><p>Fit a logistic or a linear regression to estimate <span class="math inline">\(\overline{Q} = \mathbb{E}(Y \mid A, L(0))\)</span></p></li>
<li><p>Use this estimate to predict an outcome for each subject <span class="math inline">\(\hat{\overline{Q}}(A=0)_i\)</span> and <span class="math inline">\(\hat{\overline{Q}}(A=1)_i\)</span>, by evaluating the regression fit <span class="math inline">\(\overline{Q}\)</span> at <span class="math inline">\(A=0\)</span> and <span class="math inline">\(A=1\)</span> respectively</p></li>
<li><p>Plug the predicted outcomes in the g-formula and use the sample mean to estimate <span class="math inline">\(\Psi_{ATE}\)</span>.</p></li>
</ol>
<p>We can estimate its components and plug them directly in the g-formula:
<span class="math display">\[\begin{equation}
\hat{\Psi}^{\text{ATE}}_{\text{gcomp}} = \frac{1}{n} \sum_{i=1}^n \left[ \hat{\overline{Q}}(A=1)_i - \hat{\overline{Q}}(A=0)_i \right]
\end{equation}\]</span></p>
<p>For continuous outcomes, <span class="math inline">\(\overline{Q}(A=a)\)</span> functions can be estimated using linear regressions. For binary outcomes, they can be estimated using logistic regressions.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="reminders---estimate-the-ate.html#cb6-1" tabindex="-1"></a><span class="do">## 0. Import data</span></span>
<span id="cb6-2"><a href="reminders---estimate-the-ate.html#cb6-2" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb6-3"><a href="reminders---estimate-the-ate.html#cb6-3" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">&quot;data/df.csv&quot;</span>)</span>
<span id="cb6-4"><a href="reminders---estimate-the-ate.html#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="reminders---estimate-the-ate.html#cb6-5" tabindex="-1"></a><span class="do">## 1. Estimate Qbar  </span></span>
<span id="cb6-6"><a href="reminders---estimate-the-ate.html#cb6-6" tabindex="-1"></a>Q_tot_death <span class="ot">&lt;-</span> <span class="fu">glm</span>(death <span class="sc">~</span> edu <span class="sc">+</span> sex <span class="sc">+</span> low_par_edu, </span>
<span id="cb6-7"><a href="reminders---estimate-the-ate.html#cb6-7" tabindex="-1"></a>                   <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>, <span class="at">data =</span> df)</span>
<span id="cb6-8"><a href="reminders---estimate-the-ate.html#cb6-8" tabindex="-1"></a>Q_tot_score <span class="ot">&lt;-</span> <span class="fu">glm</span>(score <span class="sc">~</span> edu <span class="sc">+</span> sex <span class="sc">+</span> low_par_edu, </span>
<span id="cb6-9"><a href="reminders---estimate-the-ate.html#cb6-9" tabindex="-1"></a>                   <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>, <span class="at">data =</span> df)</span>
<span id="cb6-10"><a href="reminders---estimate-the-ate.html#cb6-10" tabindex="-1"></a></span>
<span id="cb6-11"><a href="reminders---estimate-the-ate.html#cb6-11" tabindex="-1"></a><span class="do">## 2. Predict an outcome for each subject, setting A=0 and A=1</span></span>
<span id="cb6-12"><a href="reminders---estimate-the-ate.html#cb6-12" tabindex="-1"></a><span class="co"># prepare data sets used to predict the outcome under the counterfactual </span></span>
<span id="cb6-13"><a href="reminders---estimate-the-ate.html#cb6-13" tabindex="-1"></a><span class="co"># scenarios setting A=0 and A=1</span></span>
<span id="cb6-14"><a href="reminders---estimate-the-ate.html#cb6-14" tabindex="-1"></a>data_Ais1 <span class="ot">&lt;-</span> data_Ais0 <span class="ot">&lt;-</span> df</span>
<span id="cb6-15"><a href="reminders---estimate-the-ate.html#cb6-15" tabindex="-1"></a>data_Ais1<span class="sc">$</span>edu <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb6-16"><a href="reminders---estimate-the-ate.html#cb6-16" tabindex="-1"></a>data_Ais0<span class="sc">$</span>edu <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-17"><a href="reminders---estimate-the-ate.html#cb6-17" tabindex="-1"></a></span>
<span id="cb6-18"><a href="reminders---estimate-the-ate.html#cb6-18" tabindex="-1"></a><span class="co"># predict values</span></span>
<span id="cb6-19"><a href="reminders---estimate-the-ate.html#cb6-19" tabindex="-1"></a>Y1_death_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(Q_tot_death, <span class="at">newdata =</span> data_Ais1, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb6-20"><a href="reminders---estimate-the-ate.html#cb6-20" tabindex="-1"></a>Y0_death_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(Q_tot_death, <span class="at">newdata =</span> data_Ais0, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb6-21"><a href="reminders---estimate-the-ate.html#cb6-21" tabindex="-1"></a></span>
<span id="cb6-22"><a href="reminders---estimate-the-ate.html#cb6-22" tabindex="-1"></a>Y1_score_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(Q_tot_score, <span class="at">newdata =</span> data_Ais1, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb6-23"><a href="reminders---estimate-the-ate.html#cb6-23" tabindex="-1"></a>Y0_score_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(Q_tot_score, <span class="at">newdata =</span> data_Ais0, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb6-24"><a href="reminders---estimate-the-ate.html#cb6-24" tabindex="-1"></a></span>
<span id="cb6-25"><a href="reminders---estimate-the-ate.html#cb6-25" tabindex="-1"></a><span class="do">## 3. Plug the predicted outcome in the gformula and use the sample mean </span></span>
<span id="cb6-26"><a href="reminders---estimate-the-ate.html#cb6-26" tabindex="-1"></a><span class="do">##    to estimate the ATE</span></span>
<span id="cb6-27"><a href="reminders---estimate-the-ate.html#cb6-27" tabindex="-1"></a>ATE_death_gcomp <span class="ot">&lt;-</span> <span class="fu">mean</span>(Y1_death_pred) <span class="sc">-</span> <span class="fu">mean</span>(Y0_death_pred)</span>
<span id="cb6-28"><a href="reminders---estimate-the-ate.html#cb6-28" tabindex="-1"></a>ATE_death_gcomp</span></code></pre></div>
<pre><code>## [1] 0.1867172</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="reminders---estimate-the-ate.html#cb8-1" tabindex="-1"></a>ATE_score_gcomp <span class="ot">&lt;-</span> <span class="fu">mean</span>(Y1_score_pred) <span class="sc">-</span> <span class="fu">mean</span>(Y0_score_pred)</span>
<span id="cb8-2"><a href="reminders---estimate-the-ate.html#cb8-2" tabindex="-1"></a>ATE_score_gcomp</span></code></pre></div>
<pre><code>## [1] -19.75274</code></pre>
<p>A 95% confidence interval can be estimated applying a bootstrap procedure. An example is given in the following code.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="reminders---estimate-the-ate.html#cb10-1" tabindex="-1"></a><span class="do">## set seed for reproducibility</span></span>
<span id="cb10-2"><a href="reminders---estimate-the-ate.html#cb10-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb10-3"><a href="reminders---estimate-the-ate.html#cb10-3" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="co"># use a large number here (at least 200 to 1000)</span></span>
<span id="cb10-4"><a href="reminders---estimate-the-ate.html#cb10-4" tabindex="-1"></a></span>
<span id="cb10-5"><a href="reminders---estimate-the-ate.html#cb10-5" tabindex="-1"></a><span class="do">## we will store estimates from each bootstrap sample in a data.frame:</span></span>
<span id="cb10-6"><a href="reminders---estimate-the-ate.html#cb10-6" tabindex="-1"></a>bootstrap_estimates <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> B, <span class="at">ncol =</span> <span class="dv">2</span>))</span>
<span id="cb10-7"><a href="reminders---estimate-the-ate.html#cb10-7" tabindex="-1"></a><span class="fu">colnames</span>(bootstrap_estimates) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;boot_death_est&quot;</span>, <span class="st">&quot;boot_score_est&quot;</span>)</span>
<span id="cb10-8"><a href="reminders---estimate-the-ate.html#cb10-8" tabindex="-1"></a><span class="cf">for</span> (b <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B){</span>
<span id="cb10-9"><a href="reminders---estimate-the-ate.html#cb10-9" tabindex="-1"></a>  <span class="co"># sample the indices 1 to n with replacement</span></span>
<span id="cb10-10"><a href="reminders---estimate-the-ate.html#cb10-10" tabindex="-1"></a>  bootIndices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df), <span class="at">replace=</span>T)</span>
<span id="cb10-11"><a href="reminders---estimate-the-ate.html#cb10-11" tabindex="-1"></a>  bootData <span class="ot">&lt;-</span> df[bootIndices,]</span>
<span id="cb10-12"><a href="reminders---estimate-the-ate.html#cb10-12" tabindex="-1"></a></span>
<span id="cb10-13"><a href="reminders---estimate-the-ate.html#cb10-13" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">round</span>(b<span class="sc">/</span><span class="dv">100</span>, <span class="dv">0</span>) <span class="sc">==</span> b<span class="sc">/</span><span class="dv">100</span> ) <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;bootstrap number &quot;</span>,b))</span>
<span id="cb10-14"><a href="reminders---estimate-the-ate.html#cb10-14" tabindex="-1"></a>  </span>
<span id="cb10-15"><a href="reminders---estimate-the-ate.html#cb10-15" tabindex="-1"></a>  Q_tot_death <span class="ot">&lt;-</span> <span class="fu">glm</span>(death <span class="sc">~</span> edu <span class="sc">+</span> sex <span class="sc">+</span> low_par_edu, </span>
<span id="cb10-16"><a href="reminders---estimate-the-ate.html#cb10-16" tabindex="-1"></a>                   <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>, <span class="at">data =</span> bootData)</span>
<span id="cb10-17"><a href="reminders---estimate-the-ate.html#cb10-17" tabindex="-1"></a>  Q_tot_score <span class="ot">&lt;-</span> <span class="fu">glm</span>(score <span class="sc">~</span> edu <span class="sc">+</span> sex <span class="sc">+</span> low_par_edu, </span>
<span id="cb10-18"><a href="reminders---estimate-the-ate.html#cb10-18" tabindex="-1"></a>                   <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>, <span class="at">data =</span> bootData)</span>
<span id="cb10-19"><a href="reminders---estimate-the-ate.html#cb10-19" tabindex="-1"></a></span>
<span id="cb10-20"><a href="reminders---estimate-the-ate.html#cb10-20" tabindex="-1"></a>  boot_Ais1 <span class="ot">&lt;-</span> boot_Ais0 <span class="ot">&lt;-</span> bootData</span>
<span id="cb10-21"><a href="reminders---estimate-the-ate.html#cb10-21" tabindex="-1"></a>  boot_Ais1<span class="sc">$</span>edu <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb10-22"><a href="reminders---estimate-the-ate.html#cb10-22" tabindex="-1"></a>  boot_Ais0<span class="sc">$</span>edu <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-23"><a href="reminders---estimate-the-ate.html#cb10-23" tabindex="-1"></a></span>
<span id="cb10-24"><a href="reminders---estimate-the-ate.html#cb10-24" tabindex="-1"></a>  Y1_death_boot <span class="ot">&lt;-</span> <span class="fu">predict</span>(Q_tot_death, <span class="at">newdata =</span> boot_Ais1, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb10-25"><a href="reminders---estimate-the-ate.html#cb10-25" tabindex="-1"></a>  Y0_death_boot <span class="ot">&lt;-</span> <span class="fu">predict</span>(Q_tot_death, <span class="at">newdata =</span> boot_Ais0, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb10-26"><a href="reminders---estimate-the-ate.html#cb10-26" tabindex="-1"></a></span>
<span id="cb10-27"><a href="reminders---estimate-the-ate.html#cb10-27" tabindex="-1"></a>  Y1_score_boot <span class="ot">&lt;-</span> <span class="fu">predict</span>(Q_tot_score, <span class="at">newdata =</span> boot_Ais1, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb10-28"><a href="reminders---estimate-the-ate.html#cb10-28" tabindex="-1"></a>  Y0_score_boot <span class="ot">&lt;-</span> <span class="fu">predict</span>(Q_tot_score, <span class="at">newdata =</span> boot_Ais0, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb10-29"><a href="reminders---estimate-the-ate.html#cb10-29" tabindex="-1"></a></span>
<span id="cb10-30"><a href="reminders---estimate-the-ate.html#cb10-30" tabindex="-1"></a>  bootstrap_estimates[b,<span class="st">&quot;boot_death_est&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(Y1_death_boot <span class="sc">-</span> Y0_death_boot)</span>
<span id="cb10-31"><a href="reminders---estimate-the-ate.html#cb10-31" tabindex="-1"></a>  bootstrap_estimates[b,<span class="st">&quot;boot_score_est&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(Y1_score_boot <span class="sc">-</span> Y0_score_boot)</span>
<span id="cb10-32"><a href="reminders---estimate-the-ate.html#cb10-32" tabindex="-1"></a>}</span>
<span id="cb10-33"><a href="reminders---estimate-the-ate.html#cb10-33" tabindex="-1"></a></span>
<span id="cb10-34"><a href="reminders---estimate-the-ate.html#cb10-34" tabindex="-1"></a>IC95_ATE_death <span class="ot">&lt;-</span> <span class="fu">c</span>(ATE_death_gcomp <span class="sc">-</span> </span>
<span id="cb10-35"><a href="reminders---estimate-the-ate.html#cb10-35" tabindex="-1"></a>                      <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> <span class="fu">sd</span>(bootstrap_estimates[,<span class="st">&quot;boot_death_est&quot;</span>]),</span>
<span id="cb10-36"><a href="reminders---estimate-the-ate.html#cb10-36" tabindex="-1"></a>                    ATE_death_gcomp <span class="sc">+</span> </span>
<span id="cb10-37"><a href="reminders---estimate-the-ate.html#cb10-37" tabindex="-1"></a>                      <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> <span class="fu">sd</span>(bootstrap_estimates[,<span class="st">&quot;boot_death_est&quot;</span>]))</span>
<span id="cb10-38"><a href="reminders---estimate-the-ate.html#cb10-38" tabindex="-1"></a>IC95_ATE_death</span></code></pre></div>
<pre><code>## [1] 0.1694074 0.2040270</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="reminders---estimate-the-ate.html#cb12-1" tabindex="-1"></a>IC95_ATE_score <span class="ot">&lt;-</span> <span class="fu">c</span>(ATE_score_gcomp <span class="sc">-</span> </span>
<span id="cb12-2"><a href="reminders---estimate-the-ate.html#cb12-2" tabindex="-1"></a>                      <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> <span class="fu">sd</span>(bootstrap_estimates[,<span class="st">&quot;boot_score_est&quot;</span>]),</span>
<span id="cb12-3"><a href="reminders---estimate-the-ate.html#cb12-3" tabindex="-1"></a>                    ATE_score_gcomp <span class="sc">+</span> </span>
<span id="cb12-4"><a href="reminders---estimate-the-ate.html#cb12-4" tabindex="-1"></a>                      <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> <span class="fu">sd</span>(bootstrap_estimates[,<span class="st">&quot;boot_score_est&quot;</span>]))</span>
<span id="cb12-5"><a href="reminders---estimate-the-ate.html#cb12-5" tabindex="-1"></a>                    </span>
<span id="cb12-6"><a href="reminders---estimate-the-ate.html#cb12-6" tabindex="-1"></a>IC95_ATE_score</span></code></pre></div>
<pre><code>## [1] -20.14219 -19.36330</code></pre>
</div>
<div id="estimation-of-the-ate-by-iptw" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Estimation of the ATE by IPTW<a href="reminders---estimate-the-ate.html#estimation-of-the-ate-by-iptw" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="classic-horvitz-thompson-estimator" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> “Classic” Horvitz Thompson estimator<a href="reminders---estimate-the-ate.html#classic-horvitz-thompson-estimator" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If the average total effect (ATE) is identifiable, <span class="math inline">\(\Psi_{ATE} = \mathbb{E}(Y_{A=1}) - \mathbb{E}(Y_{A=0})\)</span> can be expressed using Inverse probability of treatment weighting (IPTW), denoting <span class="math inline">\(\mathbb{P}(A=a \mid L(0)) = g(A=a \mid L(0))\)</span>:
<span class="math display">\[\begin{equation}
\Psi_{ATE} = \mathbb{E}\left( \frac{\mathbb{I}(A=1)}{g(A=1 \mid L(0))} Y \right) - \mathbb{E}\left( \frac{\mathbb{I}(A=0)}{g(A=0 \mid L(0))} Y \right)
\end{equation}\]</span></p>
<p>The following steps describe the implementation of the IPTW estimator</p>
<ol style="list-style-type: decimal">
<li><p>Estimate the treatment mechanism <span class="math inline">\(g(A=1 \mid L(0))\)</span></p></li>
<li><p>Predict each individual’s probability of being exposed to her own exposure</p></li>
<li><p>Apply weights corresponding to the inverse of the predicted probability <span class="math inline">\(w_i = \frac{1}{\hat{g}(A = a_i \mid L(0)_i)}\)</span></p></li>
<li><p>Use the empirical mean of the weighted outcome <span class="math inline">\(Y\)</span>: <span class="math inline">\(\hat{\mathbb{E}}(Y_a) = \frac{1}{n} \sum_{i=1}^n \frac{\mathbb{I}(A_i=a)}{\hat{g}(A=a_i \mid L(0)_i)} Y_i\)</span></p></li>
</ol>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="reminders---estimate-the-ate.html#cb14-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb14-2"><a href="reminders---estimate-the-ate.html#cb14-2" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">&quot;data/df.csv&quot;</span>)</span>
<span id="cb14-3"><a href="reminders---estimate-the-ate.html#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="reminders---estimate-the-ate.html#cb14-4" tabindex="-1"></a><span class="do">## 1. Estimate g</span></span>
<span id="cb14-5"><a href="reminders---estimate-the-ate.html#cb14-5" tabindex="-1"></a>g_L <span class="ot">&lt;-</span> <span class="fu">glm</span>(edu <span class="sc">~</span> sex <span class="sc">+</span> low_par_edu, </span>
<span id="cb14-6"><a href="reminders---estimate-the-ate.html#cb14-6" tabindex="-1"></a>           <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>, <span class="at">data =</span> df)</span>
<span id="cb14-7"><a href="reminders---estimate-the-ate.html#cb14-7" tabindex="-1"></a></span>
<span id="cb14-8"><a href="reminders---estimate-the-ate.html#cb14-8" tabindex="-1"></a><span class="do">## 2. Predict each individual&#39;s probability of being exposed to her own exposure</span></span>
<span id="cb14-9"><a href="reminders---estimate-the-ate.html#cb14-9" tabindex="-1"></a><span class="co"># predict the probabilities P(A0_PM2.5=1|L(0)) &amp; P(A0_PM2.5=0|L(0))</span></span>
<span id="cb14-10"><a href="reminders---estimate-the-ate.html#cb14-10" tabindex="-1"></a>pred_g1_L <span class="ot">&lt;-</span> <span class="fu">predict</span>(g_L, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb14-11"><a href="reminders---estimate-the-ate.html#cb14-11" tabindex="-1"></a>pred_g0_L <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> pred_g1_L</span>
<span id="cb14-12"><a href="reminders---estimate-the-ate.html#cb14-12" tabindex="-1"></a><span class="co"># the predicted probability of the observed treatment A=a_i is :</span></span>
<span id="cb14-13"><a href="reminders---estimate-the-ate.html#cb14-13" tabindex="-1"></a>gA_L <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(df))</span>
<span id="cb14-14"><a href="reminders---estimate-the-ate.html#cb14-14" tabindex="-1"></a>gA_L[df<span class="sc">$</span>edu <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> pred_g1_L[df<span class="sc">$</span>edu <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb14-15"><a href="reminders---estimate-the-ate.html#cb14-15" tabindex="-1"></a>gA_L[df<span class="sc">$</span>edu <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> pred_g0_L[df<span class="sc">$</span>edu <span class="sc">==</span> <span class="dv">0</span>]</span>
<span id="cb14-16"><a href="reminders---estimate-the-ate.html#cb14-16" tabindex="-1"></a></span>
<span id="cb14-17"><a href="reminders---estimate-the-ate.html#cb14-17" tabindex="-1"></a><span class="do">## 3. Apply weights corresponding to the inverse of the predicted probability</span></span>
<span id="cb14-18"><a href="reminders---estimate-the-ate.html#cb14-18" tabindex="-1"></a>wt <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> gA_L</span>
<span id="cb14-19"><a href="reminders---estimate-the-ate.html#cb14-19" tabindex="-1"></a></span>
<span id="cb14-20"><a href="reminders---estimate-the-ate.html#cb14-20" tabindex="-1"></a><span class="do">## 4. Use the empirical mean of the weighted outcome</span></span>
<span id="cb14-21"><a href="reminders---estimate-the-ate.html#cb14-21" tabindex="-1"></a><span class="co"># point estimates:</span></span>
<span id="cb14-22"><a href="reminders---estimate-the-ate.html#cb14-22" tabindex="-1"></a>IPTW_death <span class="ot">&lt;-</span> <span class="fu">mean</span>(wt <span class="sc">*</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>edu <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">*</span> df<span class="sc">$</span>death) <span class="sc">-</span></span>
<span id="cb14-23"><a href="reminders---estimate-the-ate.html#cb14-23" tabindex="-1"></a>  <span class="fu">mean</span>(wt <span class="sc">*</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>edu <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">*</span> df<span class="sc">$</span>death)</span>
<span id="cb14-24"><a href="reminders---estimate-the-ate.html#cb14-24" tabindex="-1"></a>IPTW_death</span></code></pre></div>
<pre><code>## [1] 0.1865118</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="reminders---estimate-the-ate.html#cb16-1" tabindex="-1"></a>IPTW_score <span class="ot">&lt;-</span> <span class="fu">mean</span>(wt <span class="sc">*</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>edu <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">*</span> df<span class="sc">$</span>score) <span class="sc">-</span></span>
<span id="cb16-2"><a href="reminders---estimate-the-ate.html#cb16-2" tabindex="-1"></a>  <span class="fu">mean</span>(wt <span class="sc">*</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>edu <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">*</span> df<span class="sc">$</span>score)</span>
<span id="cb16-3"><a href="reminders---estimate-the-ate.html#cb16-3" tabindex="-1"></a>IPTW_score</span></code></pre></div>
<pre><code>## [1] -19.76854</code></pre>
<p>The ATE estimates using IPTW for death probability and mean quality of life are respectively +18.65% and -19.77.</p>
</div>
<div id="stabilized-iptw-for-the-ate" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Stabilized IPTW for the ATE<a href="reminders---estimate-the-ate.html#stabilized-iptw-for-the-ate" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If the average total effect (ATE) is identifiable, <span class="math inline">\(\Psi_{ATE}\)</span> can be estimated using a stabilized IPTW estimator:
<span class="math display">\[\begin{equation}
\hat{\mathbb{E}}(Y_1) - \hat{\mathbb{E}}(Y_0) =  \frac{\frac{1}{n} \sum_{i=1}^n \frac{\mathbb{I}(A_i=1)\hat{g}^*(A_i=1)}{\hat{g}(A_i=1 \mid L(0)_i)} Y_i}{ \frac{1}{n} \sum_{i=1}^n \frac{\mathbb{I}(A_i=1)\hat{g}^*(A_i=1)}{\hat{g}(A_i=1 \mid L(0)_i)}} - \frac{\frac{1}{n} \sum_{i=1}^n \frac{\mathbb{I}(A_i=0)\hat{g}^*(A_i=0)}{\hat{g}(A_i=0 \mid L(0)_i)} Y_i}{ \frac{1}{n} \sum_{i=1}^n \frac{\mathbb{I}(A_i=0)\hat{g}^*(A_i=0)}{\hat{g}(A_i=0 \mid L(0)_i)}}
\end{equation}\]</span>
The estimation algorithm is the same as for IPTW, but taking into account any non-null function of <span class="math inline">\(A\)</span> (<span class="math inline">\(g^*(A_i=a)\)</span>) in the denominator of the weight in step 3, and applying the stabilized estimator in step 4.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="reminders---estimate-the-ate.html#cb18-1" tabindex="-1"></a><span class="do">## 3. For example, applying g^*(A) = 1</span></span>
<span id="cb18-2"><a href="reminders---estimate-the-ate.html#cb18-2" tabindex="-1"></a><span class="do">## 4. Applying the stabilized estimator</span></span>
<span id="cb18-3"><a href="reminders---estimate-the-ate.html#cb18-3" tabindex="-1"></a><span class="co"># point estimates:</span></span>
<span id="cb18-4"><a href="reminders---estimate-the-ate.html#cb18-4" tabindex="-1"></a>sIPTW_death <span class="ot">&lt;-</span> (<span class="fu">mean</span>(wt <span class="sc">*</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>edu <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">*</span> df<span class="sc">$</span>death) <span class="sc">/</span></span>
<span id="cb18-5"><a href="reminders---estimate-the-ate.html#cb18-5" tabindex="-1"></a>                   <span class="fu">mean</span>(wt <span class="sc">*</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>edu <span class="sc">==</span> <span class="dv">1</span>))) <span class="sc">-</span></span>
<span id="cb18-6"><a href="reminders---estimate-the-ate.html#cb18-6" tabindex="-1"></a>  (<span class="fu">mean</span>(wt <span class="sc">*</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>edu <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">*</span> df<span class="sc">$</span>death) <span class="sc">/</span></span>
<span id="cb18-7"><a href="reminders---estimate-the-ate.html#cb18-7" tabindex="-1"></a>     <span class="fu">mean</span>(wt <span class="sc">*</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>edu <span class="sc">==</span> <span class="dv">0</span>)))</span>
<span id="cb18-8"><a href="reminders---estimate-the-ate.html#cb18-8" tabindex="-1"></a>sIPTW_death</span></code></pre></div>
<pre><code>## [1] 0.1865687</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="reminders---estimate-the-ate.html#cb20-1" tabindex="-1"></a>sIPTW.score <span class="ot">&lt;-</span> (<span class="fu">mean</span>(wt <span class="sc">*</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>edu <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">*</span> df<span class="sc">$</span>score) <span class="sc">/</span></span>
<span id="cb20-2"><a href="reminders---estimate-the-ate.html#cb20-2" tabindex="-1"></a>                 <span class="fu">mean</span>(wt <span class="sc">*</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>edu <span class="sc">==</span> <span class="dv">1</span>))) <span class="sc">-</span></span>
<span id="cb20-3"><a href="reminders---estimate-the-ate.html#cb20-3" tabindex="-1"></a>  (<span class="fu">mean</span>(wt <span class="sc">*</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>edu <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">*</span> df<span class="sc">$</span>score) <span class="sc">/</span></span>
<span id="cb20-4"><a href="reminders---estimate-the-ate.html#cb20-4" tabindex="-1"></a>     <span class="fu">mean</span>(wt <span class="sc">*</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>edu <span class="sc">==</span> <span class="dv">0</span>)))</span>
<span id="cb20-5"><a href="reminders---estimate-the-ate.html#cb20-5" tabindex="-1"></a>sIPTW.score</span></code></pre></div>
<pre><code>## [1] -19.75943</code></pre>
<p>The ATE estimates using stabilized IPTW for death probability and mean quality of life are respectively +18.66% and -19.76.</p>
</div>
<div id="using-an-msm-estimated-by-iptw" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Using an MSM estimated by IPTW<a href="reminders---estimate-the-ate.html#using-an-msm-estimated-by-iptw" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can also express the ATE using coefficients of a MSM. For a continuous or binary outcome, we can use the following MSM to summarize the relationship between the counterfactual outcome (<span class="math inline">\(Y_a\)</span>) and the exposure(s) <span class="math inline">\(A\)</span>:
<span class="math display" id="eq:MSMATEmarg">\[\begin{equation}
  \mathbb{E}(Y_a) = \alpha_0 + \alpha_A a
  \tag{2.1}
\end{equation}\]</span></p>
<p>The Average Total Effect <span class="math inline">\(\text{ATE} = \mathbb{E}(Y_{A=1}) - \mathbb{E}(Y_{A=0})\)</span> can then be expressed using the coefficients of this MSM <a href="reminders---estimate-the-ate.html#eq:MSMATEmarg">(2.1)</a>:
<span class="math display">\[\begin{equation*}
  \text{ATE} := \left(\alpha_0 + \alpha_A \times 1 \right) - \left(\alpha_0 + \alpha_A \times 0 \right) = \alpha_A
\end{equation*}\]</span></p>
<p>In this example, the coefficient <span class="math inline">\(\alpha_A\)</span> corresponds to the <span class="math inline">\(\text{ATE}\)</span>.</p>
<p>Such a model is not very useful for a binary exposure. It would be much more useful for higher-dimensional exposures, for example with a continuous exposure, where the relationship between all the possible continuous values of the exposure <span class="math inline">\(A=a\)</span> and the corresponding outcomes <span class="math inline">\(Y_a\)</span> is summarized (and arbitrarily simplified) by a single line and the slope coefficient <span class="math inline">\(\alpha_A\)</span>.</p>
<p>MSM coefficients can be easily estimated using an Inverse Probability of Treatment (IPTW) approach based on weighted regressions.</p>
<p>For example, in order to fit the MSM <a href="reminders---estimate-the-ate.html#eq:MSMATEmarg">(2.1)</a> described above, we can use a linear regression of the (observed) outcome <span class="math inline">\(Y\)</span> on the exposure, weigthed by individual weights <span class="math inline">\(w_i\)</span> or <span class="math inline">\(sw_i\)</span>:
<span class="math display">\[\begin{equation}
  \mathbb{E}(Y) = \alpha_0 + \alpha_A a
\end{equation}\]</span></p>
<p>where <span class="math inline">\(w_i=\frac{1}{P(A=a_i \mid L(0)=l(0)_i)}\)</span> or <span class="math inline">\(sw_i=\frac{P(A=a_i)}{P(A=a_i \mid L(0)=l(0)_i)}\)</span>.</p>
<p>The “no-unmeasured confounding” assumption is addressed by the application of weights <span class="math inline">\(w_i\)</span> or <span class="math inline">\(sw_i\)</span>, which balance confounders <span class="math inline">\(L(0)\)</span> relative to the exposure <span class="math inline">\(A\)</span>.</p>
<p>Below, we give an example where the parameters of an MSM are estimated using a weighted regression.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="reminders---estimate-the-ate.html#cb22-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb22-2"><a href="reminders---estimate-the-ate.html#cb22-2" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">&quot;data/df.csv&quot;</span>)</span>
<span id="cb22-3"><a href="reminders---estimate-the-ate.html#cb22-3" tabindex="-1"></a></span>
<span id="cb22-4"><a href="reminders---estimate-the-ate.html#cb22-4" tabindex="-1"></a><span class="do">## 1. Denominator of the weight</span></span>
<span id="cb22-5"><a href="reminders---estimate-the-ate.html#cb22-5" tabindex="-1"></a><span class="co"># 1a. Estimate g(A=a_i|L(0)) (denominator of the weight)</span></span>
<span id="cb22-6"><a href="reminders---estimate-the-ate.html#cb22-6" tabindex="-1"></a>g_A_L <span class="ot">&lt;-</span> <span class="fu">glm</span>(edu <span class="sc">~</span> sex <span class="sc">+</span> low_par_edu,</span>
<span id="cb22-7"><a href="reminders---estimate-the-ate.html#cb22-7" tabindex="-1"></a>             <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>, <span class="at">data =</span> df)</span>
<span id="cb22-8"><a href="reminders---estimate-the-ate.html#cb22-8" tabindex="-1"></a></span>
<span id="cb22-9"><a href="reminders---estimate-the-ate.html#cb22-9" tabindex="-1"></a><span class="co"># 1b. Predict each individual&#39;s probability of being exposed to her own exposure</span></span>
<span id="cb22-10"><a href="reminders---estimate-the-ate.html#cb22-10" tabindex="-1"></a><span class="co"># predict the probabilities P(edu = 1) &amp; P(edu = 0)</span></span>
<span id="cb22-11"><a href="reminders---estimate-the-ate.html#cb22-11" tabindex="-1"></a>pred_g1_L <span class="ot">&lt;-</span> <span class="fu">predict</span>(g_A_L, <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb22-12"><a href="reminders---estimate-the-ate.html#cb22-12" tabindex="-1"></a>pred_g0_L <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> pred_g1_L</span>
<span id="cb22-13"><a href="reminders---estimate-the-ate.html#cb22-13" tabindex="-1"></a><span class="co"># the predicted probability of the observed treatment P(A = a_i | L(0)) is :</span></span>
<span id="cb22-14"><a href="reminders---estimate-the-ate.html#cb22-14" tabindex="-1"></a>gAi_L <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(df))</span>
<span id="cb22-15"><a href="reminders---estimate-the-ate.html#cb22-15" tabindex="-1"></a>gAi_L[df<span class="sc">$</span>edu<span class="sc">==</span><span class="dv">1</span>] <span class="ot">&lt;-</span> pred_g1_L[df<span class="sc">$</span>edu<span class="sc">==</span><span class="dv">1</span>]</span>
<span id="cb22-16"><a href="reminders---estimate-the-ate.html#cb22-16" tabindex="-1"></a>gAi_L[df<span class="sc">$</span>edu<span class="sc">==</span><span class="dv">0</span>] <span class="ot">&lt;-</span> pred_g0_L[df<span class="sc">$</span>edu<span class="sc">==</span><span class="dv">0</span>]</span>
<span id="cb22-17"><a href="reminders---estimate-the-ate.html#cb22-17" tabindex="-1"></a></span>
<span id="cb22-18"><a href="reminders---estimate-the-ate.html#cb22-18" tabindex="-1"></a><span class="do">## 2. Numerator of the weight</span></span>
<span id="cb22-19"><a href="reminders---estimate-the-ate.html#cb22-19" tabindex="-1"></a><span class="co"># The numerator of the weight can be 1 for simple weights,</span></span>
<span id="cb22-20"><a href="reminders---estimate-the-ate.html#cb22-20" tabindex="-1"></a><span class="co"># or g(A=a_i|V) to obtain stabilized weights which put less weight to individuals</span></span>
<span id="cb22-21"><a href="reminders---estimate-the-ate.html#cb22-21" tabindex="-1"></a><span class="co"># with less observation. Stabilized weights enable a weaker positivity assumption.</span></span>
<span id="cb22-22"><a href="reminders---estimate-the-ate.html#cb22-22" tabindex="-1"></a></span>
<span id="cb22-23"><a href="reminders---estimate-the-ate.html#cb22-23" tabindex="-1"></a><span class="co"># 2a. Estimate g(A=a_i) (numerator of the stabilized weight)</span></span>
<span id="cb22-24"><a href="reminders---estimate-the-ate.html#cb22-24" tabindex="-1"></a>g_A <span class="ot">&lt;-</span> <span class="fu">glm</span>(edu <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb22-25"><a href="reminders---estimate-the-ate.html#cb22-25" tabindex="-1"></a>           <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>, <span class="at">data =</span> df)</span>
<span id="cb22-26"><a href="reminders---estimate-the-ate.html#cb22-26" tabindex="-1"></a></span>
<span id="cb22-27"><a href="reminders---estimate-the-ate.html#cb22-27" tabindex="-1"></a><span class="co"># 2b. Predict each individual&#39;s probability of being exposed to her own exposure</span></span>
<span id="cb22-28"><a href="reminders---estimate-the-ate.html#cb22-28" tabindex="-1"></a><span class="co"># predict the probabilities P(edu = 1) &amp; P(edu = 0)</span></span>
<span id="cb22-29"><a href="reminders---estimate-the-ate.html#cb22-29" tabindex="-1"></a>pred_g1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(g_A, <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb22-30"><a href="reminders---estimate-the-ate.html#cb22-30" tabindex="-1"></a>pred_g0 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> pred_g1</span>
<span id="cb22-31"><a href="reminders---estimate-the-ate.html#cb22-31" tabindex="-1"></a><span class="co"># the predicted probability of the observed treatment P(A = a_i) is :</span></span>
<span id="cb22-32"><a href="reminders---estimate-the-ate.html#cb22-32" tabindex="-1"></a>gAi <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(df))</span>
<span id="cb22-33"><a href="reminders---estimate-the-ate.html#cb22-33" tabindex="-1"></a>gAi[df<span class="sc">$</span>edu<span class="sc">==</span><span class="dv">1</span>] <span class="ot">&lt;-</span> pred_g1[df<span class="sc">$</span>edu<span class="sc">==</span><span class="dv">1</span>]</span>
<span id="cb22-34"><a href="reminders---estimate-the-ate.html#cb22-34" tabindex="-1"></a>gAi[df<span class="sc">$</span>edu<span class="sc">==</span><span class="dv">0</span>] <span class="ot">&lt;-</span> pred_g0[df<span class="sc">$</span>edu<span class="sc">==</span><span class="dv">0</span>]</span>
<span id="cb22-35"><a href="reminders---estimate-the-ate.html#cb22-35" tabindex="-1"></a></span>
<span id="cb22-36"><a href="reminders---estimate-the-ate.html#cb22-36" tabindex="-1"></a><span class="do">## 3. Define individual weights:</span></span>
<span id="cb22-37"><a href="reminders---estimate-the-ate.html#cb22-37" tabindex="-1"></a><span class="co"># We can use simple weights w = 1 / g(A=a_i | L(0))</span></span>
<span id="cb22-38"><a href="reminders---estimate-the-ate.html#cb22-38" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> gAi_L</span>
<span id="cb22-39"><a href="reminders---estimate-the-ate.html#cb22-39" tabindex="-1"></a><span class="co"># Or alternatively, we can use stabilized weights : </span></span>
<span id="cb22-40"><a href="reminders---estimate-the-ate.html#cb22-40" tabindex="-1"></a><span class="co"># sw = g(A=a_i | sex) / g(A=a_i | L(0))</span></span>
<span id="cb22-41"><a href="reminders---estimate-the-ate.html#cb22-41" tabindex="-1"></a>sw <span class="ot">&lt;-</span> gAi <span class="sc">/</span> gAi_L</span>
<span id="cb22-42"><a href="reminders---estimate-the-ate.html#cb22-42" tabindex="-1"></a></span>
<span id="cb22-43"><a href="reminders---estimate-the-ate.html#cb22-43" tabindex="-1"></a><span class="co"># we can see that stabilized weights have less extreme values</span></span>
<span id="cb22-44"><a href="reminders---estimate-the-ate.html#cb22-44" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfcol =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb22-45"><a href="reminders---estimate-the-ate.html#cb22-45" tabindex="-1"></a><span class="fu">boxplot</span>(w <span class="sc">~</span> df<span class="sc">$</span>edu)</span>
<span id="cb22-46"><a href="reminders---estimate-the-ate.html#cb22-46" tabindex="-1"></a><span class="fu">boxplot</span>(sw <span class="sc">~</span> df<span class="sc">$</span>edu)</span></code></pre></div>
<p><img src="_main_files/figure-html/Psi_ATE_bysex_MSM-1.png" width="672" /></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="reminders---estimate-the-ate.html#cb23-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfcol =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb23-2"><a href="reminders---estimate-the-ate.html#cb23-2" tabindex="-1"></a></span>
<span id="cb23-3"><a href="reminders---estimate-the-ate.html#cb23-3" tabindex="-1"></a><span class="do">## applying these weights creates a pseudo-population were the baseline</span></span>
<span id="cb23-4"><a href="reminders---estimate-the-ate.html#cb23-4" tabindex="-1"></a><span class="do">## confounders are balanced, relative to the exposure:</span></span>
<span id="cb23-5"><a href="reminders---estimate-the-ate.html#cb23-5" tabindex="-1"></a><span class="do">## before applying weights to the individuals:</span></span>
<span id="cb23-6"><a href="reminders---estimate-the-ate.html#cb23-6" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(df<span class="sc">$</span>sex, df<span class="sc">$</span>edu, <span class="at">deparse.level =</span> <span class="dv">2</span>), </span>
<span id="cb23-7"><a href="reminders---estimate-the-ate.html#cb23-7" tabindex="-1"></a>           <span class="at">margin =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##       df$edu
## df$sex         0         1
##      0 0.5245861 0.5692928
##      1 0.4754139 0.4307072</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="reminders---estimate-the-ate.html#cb25-1" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(df<span class="sc">$</span>low_par_edu, df<span class="sc">$</span>edu, <span class="at">deparse.level =</span> <span class="dv">2</span>), </span>
<span id="cb25-2"><a href="reminders---estimate-the-ate.html#cb25-2" tabindex="-1"></a>           <span class="at">margin =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##               df$edu
## df$low_par_edu         0         1
##              0 0.3397578 0.2177054
##              1 0.6602422 0.7822946</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="reminders---estimate-the-ate.html#cb27-1" tabindex="-1"></a><span class="do">## after applying weights to the individuals:</span></span>
<span id="cb27-2"><a href="reminders---estimate-the-ate.html#cb27-2" tabindex="-1"></a><span class="fu">library</span>(questionr) <span class="co"># The questionr package enables to describe weighted populations</span></span>
<span id="cb27-3"><a href="reminders---estimate-the-ate.html#cb27-3" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">wtd.table</span>(<span class="at">x =</span> df<span class="sc">$</span>sex, <span class="at">y =</span> df<span class="sc">$</span>edu, <span class="at">weights =</span> w), <span class="at">margin =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##           0         1
## 0 0.5518912 0.5516449
## 1 0.4481088 0.4483551</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="reminders---estimate-the-ate.html#cb29-1" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">wtd.table</span>(<span class="at">x =</span> df<span class="sc">$</span>low_par_edu, <span class="at">y =</span> df<span class="sc">$</span>edu, <span class="at">weights =</span> w), <span class="at">margin =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##           0         1
## 0 0.2668761 0.2669119
## 1 0.7331239 0.7330881</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="reminders---estimate-the-ate.html#cb31-1" tabindex="-1"></a><span class="do">## 4. Estimate coefficients of the MSM using a weighted regression E(Y | A, sex)</span></span>
<span id="cb31-2"><a href="reminders---estimate-the-ate.html#cb31-2" tabindex="-1"></a><span class="co"># a GLM with gaussian family can be applied to estimate risk differences</span></span>
<span id="cb31-3"><a href="reminders---estimate-the-ate.html#cb31-3" tabindex="-1"></a><span class="co"># (for relative risk or rate ratios, we can apply a Poisson family; </span></span>
<span id="cb31-4"><a href="reminders---estimate-the-ate.html#cb31-4" tabindex="-1"></a><span class="co">#  for OR, we can apply a binomial family)</span></span>
<span id="cb31-5"><a href="reminders---estimate-the-ate.html#cb31-5" tabindex="-1"></a>msm1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(death <span class="sc">~</span> edu,</span>
<span id="cb31-6"><a href="reminders---estimate-the-ate.html#cb31-6" tabindex="-1"></a>           <span class="at">weights =</span> w,</span>
<span id="cb31-7"><a href="reminders---estimate-the-ate.html#cb31-7" tabindex="-1"></a>           <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb31-8"><a href="reminders---estimate-the-ate.html#cb31-8" tabindex="-1"></a>           <span class="at">data =</span> df)</span>
<span id="cb31-9"><a href="reminders---estimate-the-ate.html#cb31-9" tabindex="-1"></a><span class="fu">coef</span>(msm1)</span></code></pre></div>
<pre><code>## (Intercept)         edu 
##   0.1441017   0.1865687</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="reminders---estimate-the-ate.html#cb33-1" tabindex="-1"></a>msm2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(death <span class="sc">~</span> edu,</span>
<span id="cb33-2"><a href="reminders---estimate-the-ate.html#cb33-2" tabindex="-1"></a>            <span class="at">weights =</span> sw,</span>
<span id="cb33-3"><a href="reminders---estimate-the-ate.html#cb33-3" tabindex="-1"></a>            <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb33-4"><a href="reminders---estimate-the-ate.html#cb33-4" tabindex="-1"></a>            <span class="at">data =</span> df)</span>
<span id="cb33-5"><a href="reminders---estimate-the-ate.html#cb33-5" tabindex="-1"></a><span class="fu">coef</span>(msm2)</span></code></pre></div>
<pre><code>## (Intercept)         edu 
##   0.1441017   0.1865687</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="reminders---estimate-the-ate.html#cb35-1" tabindex="-1"></a><span class="do">## 5. Estimate the ATE stratified by sex</span></span>
<span id="cb35-2"><a href="reminders---estimate-the-ate.html#cb35-2" tabindex="-1"></a><span class="co"># According to MSM1 (with simple weights)</span></span>
<span id="cb35-3"><a href="reminders---estimate-the-ate.html#cb35-3" tabindex="-1"></a><span class="fu">coef</span>(msm1)[<span class="st">&quot;edu&quot;</span>]</span></code></pre></div>
<pre><code>##       edu 
## 0.1865687</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="reminders---estimate-the-ate.html#cb37-1" tabindex="-1"></a><span class="co"># According to the MSM2 (with stabilized weights)</span></span>
<span id="cb37-2"><a href="reminders---estimate-the-ate.html#cb37-2" tabindex="-1"></a><span class="fu">coef</span>(msm2)[<span class="st">&quot;edu&quot;</span>]</span></code></pre></div>
<pre><code>##       edu 
## 0.1865687</code></pre>
<p>The ATE estimates of death probability using an MSM estimated by IPTW is +18.65%.</p>
<p>The results are the same with unstabilized or stabilized weights because there is no violation of the positivity assumption. In case of positivity violation, stabilized weights would give more accurate estimates.</p>
<p>95% confidence intervals can be calculated by bootstrap.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="applying-the-cmaverse.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": false,
    "twitter": false,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/benoitlepage/Inserm_workshop_282/01-Reminder_ATE_gcomp.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["_main.pdf"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
